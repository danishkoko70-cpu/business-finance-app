<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Profile â€¢ Finance App</title>
  <link rel="stylesheet" href="assets/css/style.css"/>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">
        <div class="logo"><img src="/assets/img/logo.png" alt=""/></div>
        <div>
          <h1 id="brandTitle">My Business Finance</h1>
          <small></small>
        </div>
      </div>
      <div class="userchip" id="topbarUser"></div>
    </div>

    <div class="grid">
      <aside class="sidebar">
        <nav class="nav">
          <a href="dashboard.html">Dashboard <span class="badge" data-count="income">0</span></a>
          <a href="income.html">Income <span class="badge" data-count="income">0</span></a>
          <a href="expense.html">Expense <span class="badge" data-count="expense">0</span></a>
          <a href="sales.html">Sales <span class="badge" data-count="sales">0</span></a>
          <a href="clients.html">Clients <span class="badge" data-count="clients">0</span></a>
          <a href="purchases.html">Purchases <span class="badge" data-count="purchases">0</span></a>
          <a href="bank.html">Bank <span class="badge" data-count="bank">0</span></a>
          <a href="approvals.html">Approvals <span class="badge" id="pendingBadge" data-count="approvals">0</span></a>
          <a href="reports.html">Reports <span class="badge">CSV</span></a>
          <a href="settings.html">Settings <span class="badge">Admin</span></a>
          <a href="profile.html">Profile <span class="badge">Me</span></a>
          <a href="help.html">Help <span class="badge">Guide</span></a>
        </nav>
        <hr/>
        <div class="small">
          <b>Login default:</b><br/>
          admin / admin123<br/>
          manager / manager123<br/>
          <div style="margin-top:10px">
            <button class="btn btn-small" id="btnBackup">Backup</button>
            <button class="btn btn-small" id="btnReset">Reset</button>
          </div>
          <div style="margin-top:8px" class="small">
            Backup downloads JSON (safe). Reset clears local data for this browser.
          </div>
        </div>
      </aside>

      <main class="main">
        
<div class="vstack">
  <div class="hstack" style="justify-content:space-between;">
    <div>
      <h2 style="margin:0">Profile</h2>
      <div class="small">Your login info and quick actions.</div>
    </div>
  </div>

  <div class="card" id="profileCard"></div>

  <div class="card">
    <b>Security Tip</b>
    <div class="small" style="margin-top:6px">
      If you host this app publicly, set strong passwords in Settings (Admin), and keep backups.
      This app stores data in each browser only (localStorage).
    </div>
  </div>
</div>

      </main>
    </div>
  </div>

  <script src="assets/js/app.js"></script>
  <script src="assets/js/ui.js"></script>
  
<script>
(function(){
  const auth = BMApp.requireAuth();
  if(!auth) return;
  const {st, user} = auth;
  const card = BMApp.qs("#profileCard");
  card.innerHTML = `
    <div class="hstack" style="justify-content:space-between; align-items:flex-start">
      <div>
        <b style="font-size:16px">${BMUI.escapeHtml(user.name)}</b><br/>
        <span class="small">Role: <b>${BMUI.escapeHtml(user.role)}</b></span><br/>
        <span class="small">Username: <b>${BMUI.escapeHtml(user.username)}</b></span><br/>
        <span class="small">Last Login: ${st.sessions.lastLoginAt ? new Date(st.sessions.lastLoginAt).toLocaleString() : "-"}</span>
      </div>
      <div class="vstack" style="align-items:flex-end">
        <button class="btn btn-small" id="btnBackupP">Backup</button>
        <button class="btn btn-small btn-danger" id="btnLogoutP">Logout</button>
      </div>
    </div>
  `;
  BMApp.qs("#btnBackupP").addEventListener("click", ()=>BMApp.downloadBackup());
  BMApp.qs("#btnLogoutP").addEventListener("click", ()=>{
    BMApp.signOut();
    location.href="login.html";
  });
})();
</script>

  <script>
    // global sidebar actions
    (function(){
      const auth = BMApp.requireAuth();
      if(!auth) return;
      BMUI.renderTopbar();
      BMUI.setActiveNav();
      BMUI.setCounts();

      const backupBtn = BMApp.qs("#btnBackup");
      if(backupBtn) backupBtn.addEventListener("click", ()=>BMApp.downloadBackup());

      const resetBtn = BMApp.qs("#btnReset");
      if(resetBtn) resetBtn.addEventListener("click", ()=>{
        if(confirm("Reset all data on this browser?")){
          BMApp.resetAll();
          BMApp.toast("Reset done. Please login again.", "warn");
          setTimeout(()=>location.href="login.html", 500);
        }
      });
    })();
  </script>
</body>
</html>
